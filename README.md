# Проектирование бд для сервиса по доставке продуктов на дом

В проекте будем использовать PostGIS для геолакации. Проект рассматриваю как быстрый запуск mvp, потому таблицы пока
максимально простые, только самое необходимое.

## Сервис пользователей
####  Схема в /services/users.sql

На старте для увеличения конверсии лучше выбрать одно обязательное поле для идентификации из трех(емейл/телефон/логин), но тогда проверку на заполнение нужно выносить
в логику приложения. Есть риск пропуска. Сейчас сделал в таблице обязательным только телефон, что может отпугнуть пользователей, которые хотели бы зарегаться по емейл.  
Более полную необязательную информацию о пользователе лучше вынести в таблицу профиля

## Сервис заказов
####  Схема в /services/orders.sql 

Для примера в sql создал статусы, но думаю лучше вынести enum статусов в логику приложения.

## Сервис витрины
####  Схема в /services/goods.sql 
В darkstores создал полигон, можно было бы обойтись и радиусом, но полигон удобнее. К примеру когда граница города кривая,
а доставка только по городу. Или дарксторы рядом, тоже можно границу очертить через полигон.
Пользователь по своим координатам адреса увидит какой даркстор его покрывает.   
Добавил индекс на имя товара, но не уверен, что это ок. С одной стороны поможет с поиском по имени, если совпадение точное. 
Но если поиск на вхождение подстроки, то нужен GIN или вообще синхронизация с эластик. 



## Сервис сборки
####  Схема в /services/assembly.sql 

Тут сделал только 2 таблицы: сборщик и связь сборщика с заказом. Статистику можно подсчитать в приложении по количеству 
собранных заказов. Из условия не понятно есть ли тарифы за скорость, количество, рейтинг и т.д. Если будут, то надо
еще таблицу или расширить текущую. 

## Сервис доставки
####  Схема в /services/delivery.sql 

Курьера назначаем по координатам входящим в полигон и флагу его доступности. Доставку отслеживаем по координатам заказа 
из таблицы courier_tracking. Координаты передает мобильное приложение во время выполнения заказа.

## Сервис платежей
####  Схема в /services/payments.sql 

Тут одна таблица, но повесил много индексов.  
idx_payment_transactions_card_date - для отображения транзакций по карте и по дате
idx_payment_transactions_status - для фильтра транзакций по статусу
idx_payment_transactions_external - сделал для решения инцидентов с платежным шлюзом и для смены статусов по вебхуку. 

Статус не стал определять в таблице, поле сделал строкой.